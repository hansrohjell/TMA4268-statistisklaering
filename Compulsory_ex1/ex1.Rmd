---
subtitle: "TMA4268 Statistical Learning V2021"
title: "Compulsory exercise 1: Group 5"
author: "Hans RÃ¸hjell Odland and Aksel Haugen Madslien"
date: "2/9/2021"
output: 
  pdf_document
---
  
```{r setup, include=FALSE}
library(knitr)
knitr::opts_chunk$set(echo = TRUE,tidy=TRUE,message=FALSE,warning=FALSE,strip.white=TRUE,prompt=FALSE,
                      cache=TRUE, size="scriptsize",fig.width=4, fig.height=3)
```

```{r rpackages,eval=FALSE,echo=FALSE}
install.packages("knitr") #probably already installed
install.packages("rmarkdown") #probably already installed
install.packages("ggplot2") #plotting with ggplot
install.packages("ggfortify")  
install.packages("MASS")
install.packages("class")
install.packages("pROC")
install.packages("plotROC")
```




For some problems you will need to include some LaTex code. Please install latex on your computer and then consult Compulsory1.Rmd for hints how to write formulas in LaTex. 

An example:

$$Y_i  = f(x_i) + \varepsilon_i \ ,$$

Or the same formula $Y_i  = f(x_i) + \varepsilon_i$ in-line.


# Problem 1

## a)
 We consider $Y=f(\mathbf {x})+\varepsilon, \text{ where } \text{E}(\varepsilon)=0 \text{ and } \text{Var}(\varepsilon)=\sigma^2.$
 
We find the expected value for $\tilde{\beta}$ as 
$$
  E(\tilde{\beta}) = E[(\mathbf{x}^T\mathbf{x}+\lambda \mathbf{I})^{-1}\mathbf{x}^T\mathbf{y}] \\
  = (\mathbf{x}^T\mathbf{x}+\lambda \mathbf{I})^{-1} \mathbf{x}^T E[\mathbf{y}] \\
  = (\mathbf{x}^T\mathbf{x}+\lambda \mathbf{I})^{-1} \mathbf{x}^T \mathbf{x} \beta + \lambda\mathbf{I}\beta - \lambda\mathbf{I}\beta \\
  = (\mathbf{x}^T\mathbf{x}+\lambda \mathbf{I})^{-1} (-\lambda\mathbf{I})\beta + \mathbf{I}\beta \\
  = \beta - \lambda(\mathbf{x}^T\mathbf{x}+\lambda \mathbf{I})\beta
$$

## b)
 We let $\widetilde{f}(\mathbf{x}_0)=\mathbf{x}_0^T \widetilde{\boldsymbol{\beta}}$ The variance for $\widetilde{f}(\mathbf{x}_0)$ then becomes
 
 $$
 E[\widetilde{f}(\mathbf{x}_0)]=E[\mathbf{x}_0^T \widetilde{\boldsymbol{\beta}}] 
 = \mathbf{x}_0^T E[\widetilde{\boldsymbol{\beta}}] \\
 = \mathbf{x}_0^T(\beta - \lambda(\mathbf{x}^T\mathbf{x}+\lambda \mathbf{I})\beta)
 $$
 For the variation we get 
 $$
 Var[\widetilde{f}(\mathbf{x}_0)] = \mathbf{x}_0^T Var[\widetilde{\boldsymbol{\beta}}]\mathbf{x} \\
 = \mathbf{x}_0^T(\beta - \lambda(\mathbf{x}^T\mathbf{x}+\lambda \mathbf{I})\beta)\mathbf{x}
 $$
## c)



```{r, echo=TRUE, eval=TRUE}
id <- "1X_8OKcoYbng1XvYFDirxjEWr7LtpNr1m" # google file ID
values <- dget(sprintf("https://docs.google.com/uc?id=%s&export=download", id))
X = values$X
dim(X)
x0 = values$x0
dim(x0)
beta=values$beta
dim(beta)
sigma=values$sigma
sigma
```

## d) 

```{r}
library(ggplot2)
bias = function(lambda, X, x0, beta) {
    p = ncol(X)
    value = 1
    return(value)
}
lambdas = seq(0, 2, length.out = 500)
BIAS = rep(NA, length(lambdas))
for (i in 1:length(lambdas)) BIAS[i] = bias(lambdas[i], X, x0, beta)
dfBias = data.frame(lambdas = lambdas, bias = BIAS)
ggplot(dfBias, aes(x = lambdas, y = bias)) + geom_line(color = "red") + xlab(expression(lambda)) + 
    ylab(expression(bias^2))
```

 

# Problem 2

## a) 

```{r}
id <- "1yYlEl5gYY3BEtJ4d7KWaFGIOEweJIn__" # google file ID
d.corona <- read.csv(sprintf("https://docs.google.com/uc?id=%s&export=download", id),header=T)


table(d.corona$deceased)

table(d.corona$country, d.corona$sex)

table(d.corona$sex, d.corona$deceased)

francedf <- subset(d.corona, country == "France")
table(francedf$sex, francedf$deceased)




```
## b) 
###i)
```{r}

# Multiple Linear Regression Example
fit <- lm(as.numeric(deceased) ~ sex + country + age, data=d.corona)
summary(fit)$coef # show results

#predict(fit)

deceasedmale <- fit$coefficients[6]*75 + fit$coefficients[2] + fit$coefficients[5]

deceasedmale



```

The probability of dying of Covid-19 for a male age in Korea is found to be `5.7%`.


###ii)

Does males have higher probability to die than females?

```{r}

fit <- glm(deceased ~ sex, data = d.corona, family = binomial)
summary(fit)$coef




```


